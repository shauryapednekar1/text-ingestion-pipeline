<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Usage - Textual Dataset Ingestion Pipeline</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Usage";
        var mkdocs_page_input_path = "user-guide/usage.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Textual Dataset Ingestion Pipeline
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">User Guide</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../installation/">Installation</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Usage</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#loading-a-textual-dataset-into-a-vectorstore">Loading a textual dataset into a vectorstore</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#using-custom-classes">Using Custom Classes</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#saving-the-vectorstore-to-disk">Saving the vectorstore to disk</a>
    </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API Reference</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../api-reference/load/">Loader</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../api-reference/chunk/">Chunker</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../api-reference/embedder/">Embedder</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../api-reference/ingest/">Ingester</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../api-reference/enhanced_document/">EnhancedDocument</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Textual Dataset Ingestion Pipeline</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">User Guide</li>
      <li class="breadcrumb-item active">Usage</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="usage-guide">Usage Guide<a class="headerlink" href="#usage-guide" title="Permanent link">&para;</a></h1>
<p>An example script can be found at <code>/scripts/example_ingestion.py</code>.
Note: Currently, this package isn't tested when passing relative paths as input. 
Thus, it's advised to store the dataset in the same directory as the script to
prevent undesired behavior.</p>
<hr />
<p>See the <a href="https://github.com/shauryapednekar1/text-ingestion-pipeline/tree/user/shaurya/add-load-framework">README</a> for more info on how the design is packaged.</p>
<hr />
<h3 id="loading-a-textual-dataset-into-a-vectorstore">Loading a textual dataset into a vectorstore<a class="headerlink" href="#loading-a-textual-dataset-into-a-vectorstore" title="Permanent link">&para;</a></h3>
<p>This is the quickest way to ingest a dataset and store the results in a vectorstore. 
It uses a default loading, chunking, and embedding strategy.
This can be done in the following manner:</p>
<pre><code class="language-python">from easy_ingest_text.ingest_text import Ingester

ingester = Ingester()
ingester.ingest_dataset(
    input_dir=&quot;financial_dataset.zip&quot;,
    is_zipped=True,
    save_intermediate_docs=True,
    output_dir=&quot;test_output&quot;,
    detailed_progress=True,
    batch_size=100,
    max_files=500,
)
</code></pre>
<p>If you want to specify different configuration options for the default <code>Loader</code>,
<code>Chunker</code>, or <code>Embedder</code>, you can do this by instantiating them individually
and passing them to the <code>Ingester</code>.</p>
<p>Here's an example where we set the
configuration options for the provided <code>JSONLoader</code>, The <code>Chunker</code> and 
<code>Embedder</code> can be overridden in a similar manner.</p>
<pre><code class="language-python">autoloader_config = {
    &quot;JSONLoader&quot;: {
        &quot;required&quot;: {
            &quot;jq_schema&quot;: &quot;.&quot;,  
        },
        &quot;optional&quot;: {
            &quot;content_key&quot;: None,
            &quot;is_content_key_jq_parsable&quot;: False,
            &quot;metadata_func&quot;: None,
            &quot;text_content&quot;: True,
            &quot;json_lines&quot;: False,
        },
    },
}
loader = Loader(autoloader_config)
ingester = Ingester(loader=loader)
...
</code></pre>
<h3 id="using-custom-classes">Using Custom Classes<a class="headerlink" href="#using-custom-classes" title="Permanent link">&para;</a></h3>
<p>If you want to include custom logic for how to load files, chunk documents,
or embed documents, you can subclass the relevant class and pass it to the
<code>Ingester</code>. Each class contains information on which methods should be
overriden.</p>
<p>Here's an example where a custom loader for loading json documents
of a specific format. </p>
<pre><code class="language-python">from easy_ingest_text.load_text import Loader
from easy_ingest_text.enhanced_document import EnhancedDocument

class CustomLoader(Loader):
    def file_to_docs(self, file_path: str) -&gt; List[EnhancedDocument]:
        file_extension = file_path.split(&quot;.&quot;)[-1]
        if file_extension == &quot;json&quot;:
            with open(file_path) as fin:
                try:
                    data = json.load(fin)
                    text = data[&quot;text&quot;]
                    # TODO(STP): Add the filename to the metadata.
                    metadata = {}
                    for key in {
                        &quot;title&quot;,
                        &quot;url&quot;,
                        &quot;site_full&quot;,
                        &quot;language&quot;,
                        &quot;published&quot;,
                    }:
                        if key in data:
                            metadata[key] = data[key]
                    if &quot;source&quot; in metadata:
                        # HACK(STP): Since source is a reserved keyword for
                        # document metadata, we need to rename it here.
                        metadata[&quot;source_&quot;] += metadata[&quot;source&quot;]
                    metadata[&quot;source&quot;] = file_path
                    return [
                        EnhancedDocument(page_content=text, metadata=metadata)
                    ]
                except Exception as e:
                    print(f&quot;Failed to parse {fin}: {e}. Skipping for now&quot;)
                    return []
        else:
            return super().file_to_docs(file_path)
</code></pre>
<h3 id="saving-the-vectorstore-to-disk">Saving the vectorstore to disk<a class="headerlink" href="#saving-the-vectorstore-to-disk" title="Permanent link">&para;</a></h3>
<p>If using a custom vectorstore, it might offer its own functionality to persist
to disk. If using the default FAISS vectorstore, you can save it to disk by
setting the <code>save_local</code> flag in its config to <code>True</code>, as shown in the example
below.</p>
<pre><code class="language-python">from easy_ingest_text.ingest_text import Ingester
from easy_ingest_text.embed_text import Embedder
import easy_ingest_text.defaults


vectorstore_config = defaults.DEFAULT_VECTORSTORES_CONFIG
vectorstore_config[&quot;FAISS&quot;][&quot;save_local_config&quot;][&quot;save_local&quot;] = True
embedder = Embedder(vectorstore_config=vectorstore_config)
ingester = Ingester(embedder=embedder)
ingester.ingest_dataset(
    input_dir=&quot;financial_dataset&quot;,
    save_intermediate_docs=True,
    output_dir=&quot;test_output&quot;,
    detailed_progress=True,
    batch_size=100,
    max_files=1000,
)
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../installation/" class="btn btn-neutral float-left" title="Installation"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../../api-reference/load/" class="btn btn-neutral float-right" title="Loader">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../installation/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../../api-reference/load/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
